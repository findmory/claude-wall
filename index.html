<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Wall</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #1a1a1a;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        position: relative;
      }

      .image-container {
        position: absolute;
        will-change: transform;
        animation-name: rain-fall;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
      }

      .image-container:hover {
        transform: scale(1.1) !important;
        z-index: 1000;
        cursor: pointer;
      }

      .image-container img {
        max-width: 200px;
        max-height: 200px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        border-radius: 4px;
      }

      @keyframes rain-fall {
        0% {
          transform: translateY(-220px);
        }
        100% {
          transform: translateY(calc(100vh + 220px));
        }
      }

      .refresh-button {
        position: fixed;
        bottom: 20px;
        left: 20px;
        padding: 12px 20px;
        background: #333;
        color: #fff;
        border: 2px solid #555;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-family: sans-serif;
        z-index: 10000;
        transition: all 0.3s ease;
      }

      .refresh-button:hover {
        background: #444;
        border-color: #777;
        transform: scale(1.05);
      }

      .refresh-button:active {
        transform: scale(0.95);
      }

      .play-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        background: #333;
        color: #fff;
        border: 2px solid #555;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-family: sans-serif;
        z-index: 10000;
        transition: all 0.3s ease;
      }

      .play-button:hover {
        background: #444;
        border-color: #777;
        transform: scale(1.05);
      }

      .play-button:active {
        transform: scale(0.95);
      }

      .play-button.playing {
        background: #4caf50;
        border-color: #66bb6a;
      }

      .image-container.highlighted {
        z-index: 9999 !important;
      }

      .image-container.highlighted img {
        transform: scale(1.2);
        box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
      }
    </style>
  </head>
  <body>
    <button class="refresh-button" onclick="refreshImages()">üîÑ Shuffle</button>
    <button class="play-button" onclick="toggleAutoPlay()">‚ñ∂Ô∏è Play</button>
    <script>
      // Path to your images folder (adjust if needed)
      const imagePath = "./images/";
      let currentImages = [];
      let isPlaying = false;
      let playInterval = null;
      let currentHighlightedImage = null;

      // Function to get random horizontal position
      function getRandomX() {
        return Math.random() * (window.innerWidth - 200);
      }

      // Function to get random animation duration (speed)
      function getRandomDuration() {
        // Random duration between 8 and 20 seconds
        return 8 + Math.random() * 12;
      }

      // Function to get random delay
      function getRandomDelay() {
        // Random delay between 0 and 10 seconds for staggering
        return Math.random() * 10;
      }

      // Function to create and position an image
      function createImageElement(filename) {
        const container = document.createElement("div");
        container.className = "image-container";

        const img = document.createElement("img");
        img.src = imagePath + filename;
        img.alt = filename;

        const x = getRandomX();
        const duration = getRandomDuration();
        const delay = getRandomDelay();

        container.style.left = x + "px";
        container.style.animationDuration = duration + "s";
        container.style.animationDelay = -delay + "s"; // Negative delay to start mid-animation

        container.appendChild(img);
        document.body.appendChild(container);
      }

      // Function to clear all images
      function clearImages() {
        document.querySelectorAll(".image-container").forEach((container) => {
          container.remove();
        });
      }

      // Function to refresh/shuffle images
      function refreshImages() {
        clearImages();
        currentImages.forEach((filename) => {
          createImageElement(filename);
        });
      }

      // Function to highlight a random image
      function highlightRandomImage() {
        const containers = document.querySelectorAll(".image-container");
        if (containers.length === 0) return;

        // Remove highlight from current image
        if (currentHighlightedImage) {
          currentHighlightedImage.classList.remove("highlighted");
        }

        // Pick a random image
        const randomIndex = Math.floor(Math.random() * containers.length);
        currentHighlightedImage = containers[randomIndex];

        // Add highlight class (scales up and rotates to 0)
        currentHighlightedImage.classList.add("highlighted");
      }

      // Function to toggle autoplay
      function toggleAutoPlay() {
        const playButton = document.querySelector(".play-button");

        if (isPlaying) {
          // Stop playing
          isPlaying = false;
          clearInterval(playInterval);
          playButton.textContent = "‚ñ∂Ô∏è Play";
          playButton.classList.remove("playing");

          // Remove highlight from current image
          if (currentHighlightedImage) {
            currentHighlightedImage.classList.remove("highlighted");
            currentHighlightedImage = null;
          }
        } else {
          // Start playing
          isPlaying = true;
          playButton.textContent = "‚è∏Ô∏è Pause";
          playButton.classList.add("playing");

          // Highlight first image immediately
          highlightRandomImage();

          // Then continue every 3 seconds
          playInterval = setInterval(highlightRandomImage, 1500);
        }
      }

      // Load images from the folder
      async function loadImages() {
        try {
          // Fetch the images list from JSON file
          const response = await fetch("images.json");

          if (!response.ok) {
            throw new Error(
              "Could not load images.json. Make sure to run generate-images-list.py or generate-images-list.js first!"
            );
          }

          const pngFiles = await response.json();

          // Store the images for refresh functionality
          currentImages = pngFiles;

          // Create image elements for each PNG file
          pngFiles.forEach((filename) => {
            createImageElement(filename);
          });

          if (pngFiles.length === 0) {
            console.log("No PNG files found in images.json.");
          } else {
            console.log(`Loaded ${pngFiles.length} images`);
            // Auto-start play mode after images are loaded
            toggleAutoPlay();
          }
        } catch (error) {
          console.error("Error loading images:", error);
          console.log("Make sure to run: python3 generate-images-list.py");
          console.log("Or: node generate-images-list.js");
        }
      }

      // Load images when page loads
      window.addEventListener("load", loadImages);

      // Prevent images from going off-screen on resize
      window.addEventListener("resize", () => {
        document.querySelectorAll(".image-container").forEach((container) => {
          const currentLeft = parseInt(container.style.left);
          const currentTop = parseInt(container.style.top);

          if (currentLeft > window.innerWidth - 200) {
            container.style.left = window.innerWidth - 200 + "px";
          }
          if (currentTop > window.innerHeight - 200) {
            container.style.top = window.innerHeight - 200 + "px";
          }
        });
      });
    </script>
  </body>
</html>
